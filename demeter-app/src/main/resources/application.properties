# =============================================
# Demeter AI 2.0 — Application Configuration
# =============================================

# Application
quarkus.application.name=demeter-backend
quarkus.application.version=0.1.0

# HTTP
quarkus.http.port=8080
quarkus.http.cors.enabled=true
%dev.quarkus.http.cors.origins=http://localhost:3000,http://localhost:5173
%prod.quarkus.http.cors.origins=${CORS_ORIGINS:/.*/}
quarkus.http.cors.methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization,X-Tenant-ID
quarkus.http.cors.exposed-headers=Content-Disposition
quarkus.http.cors.access-control-allow-credentials=true

# Datasource — Dev profile (default)
quarkus.datasource.db-kind=postgresql
%dev.quarkus.datasource.devservices.enabled=true
%dev.quarkus.datasource.devservices.image-name=postgres:17-alpine
%dev.quarkus.datasource.devservices.db-name=demeter
%dev.quarkus.datasource.devservices.username=demeter
%dev.quarkus.datasource.devservices.password=demeter_dev

# Datasource — Staging
%staging.quarkus.datasource.username=${DB_USER}
%staging.quarkus.datasource.password=${DB_PASSWORD}
%staging.quarkus.datasource.jdbc.url=${DB_URL}

# Datasource — Prod
%prod.quarkus.datasource.username=${DB_USER}
%prod.quarkus.datasource.password=${DB_PASSWORD}
%prod.quarkus.datasource.jdbc.url=${DB_URL}

# Hibernate ORM
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.multitenant=DISCRIMINATOR
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.mapping.format.global=ignore
%dev.quarkus.hibernate-orm.log.sql=true

# Flyway
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=db/migration

# OIDC — Dev (Auth0)
%dev.quarkus.oidc.auth-server-url=https://dev-z2bosbraaxzqii36.us.auth0.com/
%dev.quarkus.oidc.client-id=qayGNHiRur5jQGtzGx57iwkCxPGm31u2
%dev.quarkus.oidc.token.issuer=https://dev-z2bosbraaxzqii36.us.auth0.com/

# OIDC — Production (Auth0)
%prod.quarkus.oidc.auth-server-url=${OIDC_AUTH_SERVER_URL}
%prod.quarkus.oidc.client-id=${OIDC_CLIENT_ID}
%prod.quarkus.oidc.token.issuer=${OIDC_ISSUER}

# OIDC — Common
quarkus.oidc.application-type=service
quarkus.oidc.roles.role-claim-path=permissions

# OpenAPI / Swagger UI
quarkus.smallrye-openapi.info-title=Demeter AI 2.0 API
quarkus.smallrye-openapi.info-version=0.1.0
quarkus.smallrye-openapi.info-description=Multi-tenant stock control and analytics platform
quarkus.swagger-ui.always-include=true

# Quarkus multi-module: force indexing of domain module archives so JAX-RS resources
# and OpenAPI scanning include controllers from subprojects.
quarkus.index-dependency.demeter-common.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-common.artifact-id=demeter-common
quarkus.index-dependency.demeter-productos.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-productos.artifact-id=demeter-productos
quarkus.index-dependency.demeter-inventario.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-inventario.artifact-id=demeter-inventario
quarkus.index-dependency.demeter-ventas.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-ventas.artifact-id=demeter-ventas
quarkus.index-dependency.demeter-costos.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-costos.artifact-id=demeter-costos
quarkus.index-dependency.demeter-usuarios.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-usuarios.artifact-id=demeter-usuarios
quarkus.index-dependency.demeter-ubicaciones.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-ubicaciones.artifact-id=demeter-ubicaciones
quarkus.index-dependency.demeter-empaquetado.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-empaquetado.artifact-id=demeter-empaquetado
quarkus.index-dependency.demeter-precios.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-precios.artifact-id=demeter-precios
quarkus.index-dependency.demeter-analytics.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-analytics.artifact-id=demeter-analytics
quarkus.index-dependency.demeter-fotos.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-fotos.artifact-id=demeter-fotos
quarkus.index-dependency.demeter-chatbot.group-id=com.fortytwo.demeter
quarkus.index-dependency.demeter-chatbot.artifact-id=demeter-chatbot

# Health checks

# Jackson
quarkus.jackson.write-dates-as-timestamps=false

# Logging
quarkus.log.level=INFO
%dev.quarkus.log.level=DEBUG
%dev.quarkus.log.category."com.fortytwo.demeter".level=DEBUG
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# =============================================
# Virtual Threads (Project Loom - Java 21+)
# =============================================
# Enables Virtual Threads for all blocking operations.
# Benefits:
#   - Simple blocking code style (no Reactive/Mutiny complexity)
#   - Millions of concurrent threads with minimal memory (~1KB each)
#   - Automatic thread suspension during I/O (DB, HTTP, file)
#   - Clear stack traces for debugging
# Requires Java 21+ (we use Java 25)
quarkus.virtual-threads.enabled=true

# =============================================
# ML Worker Integration
# =============================================
# Direct HTTP client for dev mode (bypasses Cloud Tasks)
%dev.demeter.mlworker.url=http://localhost:8000
%dev.demeter.mlworker.timeout-seconds=300

# Staging/Prod use Cloud Tasks (not direct HTTP)
%staging.demeter.mlworker.url=${ML_WORKER_URL:http://localhost:8000}
%prod.demeter.mlworker.url=${ML_WORKER_URL}

# =============================================
# Cloud Tasks — ML Worker Integration
# =============================================
# Dev: disabled (logs tasks without creating them)
%dev.demeter.cloudtasks.enabled=false

# Staging
%staging.demeter.cloudtasks.enabled=true
%staging.demeter.cloudtasks.project-id=${GCP_PROJECT_ID}
%staging.demeter.cloudtasks.location=${GCP_REGION:us-central1}
%staging.demeter.cloudtasks.ml-worker-url=${ML_WORKER_URL}
%staging.demeter.cloudtasks.queue-name=ml-processing-queue
%staging.demeter.cloudtasks.service-account-email=${CLOUDTASKS_SA_EMAIL}

# Production
%prod.demeter.cloudtasks.enabled=true
%prod.demeter.cloudtasks.project-id=${GCP_PROJECT_ID}
%prod.demeter.cloudtasks.location=${GCP_REGION:us-central1}
%prod.demeter.cloudtasks.ml-worker-url=${ML_WORKER_URL}
%prod.demeter.cloudtasks.queue-name=ml-processing-queue
%prod.demeter.cloudtasks.service-account-email=${CLOUDTASKS_SA_EMAIL}

# =============================================
# Storage Configuration
# =============================================
# Cloud storage for images (production)
# Provider-agnostic config - implementation can be GCS, S3, etc.
%prod.demeter.storage.bucket=stockcontrol-images
%prod.demeter.storage.project-id=${GCP_PROJECT_ID}
%prod.demeter.storage.base-path=cultivadores
%staging.demeter.storage.bucket=stockcontrol-images
%staging.demeter.storage.project-id=${GCP_PROJECT_ID}
%staging.demeter.storage.base-path=cultivadores
demeter.storage.url-expiration-minutes=60

# Backend callback URL for ML Worker
%prod.demeter.backend.callback-url=${BACKEND_URL:}
%staging.demeter.backend.callback-url=${BACKEND_URL:}
